version: 0.2

env:
  variables: 
    FLOW_PROJECT_CODE: '2IhoXPKH2rz22LjB'
    FLOW_API_URL: 'https://homologa.conviso.com.br'
  secrets-manager:
    FLOW_API_KEY: FLOW_API_KEY:FLOW_API_KEY
    
phases:
  install:
    commands:
      - nohup /usr/local/bin/dockerd --host=unix:///var/run/docker.sock --host=tcp://127.0.0.1:2375 --storage-driver=overlay2&
      - timeout 15 sh -c "until docker info; do echo .; sleep 1; done"
  pre_build:
    commands:
      - ls -ltrah $CODEBUILD_SRC_DIR
      - cd $CODEBUILD_SRC_DIR && git status
      - docker run --rm hello-world
